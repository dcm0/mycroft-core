<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tama Page</title>

    <script type="text/javascript">
         // window.location.hostname
        // Let us open a web socket
       
        var ws = new WebSocket("ws://130.237.158.153:8181/core");
        ws.onmessage = function (evt) {
            var received_msg = JSON.parse(evt.data); // the whole json
            document.getElementById("info").value = document.getElementById("info").value + "\n" + evt.data;
            document.getElementById("info").value = document.getElementById("info").value + "\n" + received_msg.type;
            if (received_msg.type == "enclosure.eyes.lookstatus") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoFlag = result == "true" ? true : false;
                document.getElementById("AutoHead").checked = autoFlag;
                document.getElementById("AutoHead").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
            if (received_msg.type == "enclosure.eyes.gazeWake") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoGaze = result == "true" ? true : false;
                document.getElementById("gazeWake").checked = autoGaze;
                document.getElementById("gazeWake").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
            if (received_msg.type == "enclosure.eyes.voiceWake") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoWake = result == "true" ? true : false;
                document.getElementById("voiceWake").checked = autoWake;
                document.getElementById("voiceWake").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
        };


        function ChangeColor() {
            var msg = {
                type: 'enclosure.eyes.yellow',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }




        function moveHome() {
            logData('Home');
            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': 0 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }

        // from Tama persepctives
        function moveLeft() {
            logData('Left');
            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': 30 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }


        function moveRight() {
            logData('Right');
            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': -30 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }

        function AutoHead() {
            logData('AutoHead');
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleAutolook',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }


        function headOff() {
            logData('Head off');
            var msg = {
                type: 'enclosure.eyes.off',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }

        function headOn() {
            logData('Head on');
            var msg = {
                type: 'enclosure.eyes.on',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }


        function gazeWake() {
            logData('Gaze awake');
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleGazeWake',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }

        function voiceWake() {
            logData('Voice awake');
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleVoiceWake',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }

        //select trial to decide what data
        var data = ['start', 'end'];
        function favTrial(input) {
            // var mylist = document.getElementById("myList");
            // document.getElementById("favourite").value = mylist.options[mylist.selectedIndex].text;
            // var trial = mylist.options[mylist.selectedIndex].text;

            var trial = input.options[input.selectedIndex].text; 
            var value = input.value; // returns the value ie 1 / 2 / 3 etc

            logData(trial);
            if (trial == "Recipe 1") {
                
                data = ["We are going to cook a vegetable soup",
                    "Chop all the veggies, <break time=\"3s\"/> (carrot, cabbage, french beans, onion and garlic) into small pieces",
                    "Add 2 tablespoons cornstarch (corn flour) in a small bowl.",
                    "Add 3 tablespoons water and mix well.",
                    "Heat 1/2 tablespoon oil or butter in a large, heavy bottomed stockpot over medium flame. Add chopped onion and garlic. ",
                    "Sauté for 1-2 minutes.",
                    "Add carrots, cabbage, sweet corn kernels, french beans and salt (only for veggies).",
                    "Stir and cook for 3-4 minutes.",
                    "Add 2½ cups water or vegetable stock. Stir well and bring the mixture to a boil. When it starts boiling, add salt (add as required as we have already added salt for veggies).",
                    "Add black pepper powder.",
                    "Add cornstarch-water mixture and stir continuously for a minute to prevent lump formation.",
                    "Stir and cook until mixture turns thick and no raw smell of cornstarch. It will take around 7-8 minutes. Add vinegar and mix well.",
                    "Taste the soup for the seasonings at this stage and add more if required. Turn off the flame. Transfer hot soup of vegetables into individual serving bowls and serve.",
                    "step 14 place two yellow four"];

                inputRecipe(data)
                //console.log(data);
            } else if (trial == "Recipe 2") {
                data = ["Now, we are going to cook a vegetable soup",
                    "Heat the olive oil in a large pot over medium heat",
                    "Add the onions and season with salt and pepper",
                    "Let simmer for 3 minutes, then add the garlic, carrot, celery, and zucchini",
                    "Season with some more salt and pepper and let simmer for 6 minutes, stirring frequently.",
                    "You want the vegetables to pick up just a little color.",
                    "If you want a thicker soup, drain and rinse the cannellini beans and then either puree or mash half of them.",
                    "Add the cannellini beans, bell pepper, tomatoes, and oregano to the pot and let simmer for 3-4 minutes. ",
                    "Pour the broth into the pot and bring to a slow boil.",
                    "While you are waiting for the broth to come to a boil, mix up the dough for your dumplings.",
                    "In a medium bowl, mix the flour, baking powder, and salt together. Pour the olive oil and warm water into the bowl and mix with a fork. ",
                    "Then add the Parmesan and dried basil and mix until evenly incorporated in the dough. ",
                    "Once the broth is slowly bubbling, add the swiss chard.",
                    "Next use a spoon or a small ice cream scoop to make the dumplings and add them to the soup. ",
                    "You want to use about 2 tablespoons of dough to make each dumpling. Once you have added all the dumplings to the soup, cover the pot and let the dumplings cook for 15-20 minutes, until they are bread-like and fully cooked."];

            
          
            } else if (trial == "Intro") {
                data = ['Please follow my instructions to cook a vegetable soup',
                'From now on, I will wait until you look at me to give you the next step. It may take a moment for me to detect your gaze, so please be patient. If I am not sure if you are looking or not I will make a non-speech noise like this:'
            ];

            
        }


        else if (trial == "Trial thanks") {
                data = ['Thank you being here today, it was fun to play with you ',
                
            ];

        }

    }

         function TesxtToSpeech() {

            var text =  document.getElementById('textmsg').value
            logData('Speak msg' + ' ' + text);
            var msg = {
                type: 'speak',
                data: { 'utterance': text },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }

        var i = -1;
        var currentstepnum = i;
        function speackmsg(msg) {
            logData('Speak msg' + ' ' + msg);
            var msg = {
                type: 'speak',
                data: { 'utterance': msg },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }
    


        function next() {
            logData('Next');
            document.getElementById('inc').value = ++i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);

        
        }

        function back() {
            logData('Back');
            document.getElementById('inc').value = --i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }

        function restart() {
            logData('Restart');
            i = -1;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = '';
        }

        function reset() {
            logData('Reset');
            i = currentstepnum;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }

        function repeat() {
            logData('Repeat');
            i = currentstepnum;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }


        function error() {
            logData('Error');
            var msg = {
                type: 'enclosure.eyes.pink',
                data: '',
                end: '',
                context: { destination: '' }
            };

            ws.send(JSON.stringify(msg));
            msg = {
                type: 'enclosure.sounds.bing',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));


            var delayInMilliseconds = 2000;
            setTimeout(function() {
             //your code to be executed after 1 second
            console.log('go green');
            var msg = {
                type: 'enclosure.eyes.green',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))
            }, delayInMilliseconds);
            

        }


        function changeEyeColor(color){
            var msg = {
                type: color,
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }

        function play() {
            logData('Play');
            //if we need to go to specific step number then we need to -1 as the array starts from 0
            var j = document.getElementById('inc').value;
            document.getElementById('speechtext').value = data[j - 1];
            speackmsg(data[j - 1]);
        }

        function doNoUnderstand() {
            logData('I do not understand');
            speackmsg('I am Sorry, I do not understand!');
        }

        function startTrial() {
            logData('Start trial');
        }

        function endTrial() {
            logData('End trial');
        }

        function logData(logLine){
        var msg = {
                type: 'enclosure.trial.log',
                data: logLine,
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }

        function createListObject(e){
            return '<li>' + e.text +  '</li>'
        }
        function inputRecipe(list){
            var recipeHTML = list.map(createListObject());
            document.getElementById('recipelist').innerHTML = recipeHTML
        }
        

    </script>


</head>

<body>
    <h1>Tama control station</h1>
    <div id= "recipe">
    <b> Select a recipe </b>
    <select id="myList" name = "values" onchange="favTrial(this)">
        <option> ---Choose recipe--- </option>
        <option value ="0"> Intro</option>
        <option value ="1"> Recipe 1</option>
        <option value ="2"> Recipe 2</option>
        <div id="recipelist">
        </div>
    </select>

     <br><br>

    <b>Steps Control:</b>
    <button type="button" onClick="restart()">Restart</button>
    <button type="button" onClick="back()">Back</button>
    <button onclick="next()">Next</button>
    <button type="button" onClick="repeat()">Repeat</button>
    <button type="button" onClick="reset()">Reset</button>
    <button type="button" onClick="play()">play the current step</button>
    <input type="text" id="speechtext" value=""></input>

    <label for="html">Step number:</label>
    <input type="text" id="inc" value="-1"></input><br><br>


    </div>

        
</div>

<div id = "advice">
 <b>List of recoomendation and advices:</b>

</div>

    <div id= "short">
        <button type="button" onclick="startTrial()">Start trial</button>
        <button type="button" onclick="endTrial()">End trial</button><br><br>
        <button type="button" onClick="doNoUnderstand()">I do not understand</button>
        <button type="button" onClick="error()">Error</button><br><br>
        <label for="html">Message:</label>
        <input type="text" id="textmsg" value=""></input>
        <button type="button" onClick="TesxtToSpeech()">Speak</button><br><br>
    </div>



    <div id= "gaze">
        <b>Head Control:</b>
        <input type="checkbox" onClick="AutoHead()" id="AutoHead" checked>Auto head</input><br><
        <button type="button" onclick="moveRight()">Move Right</button>
        <button type="button" onclick="moveHome()">Move Home</button>
        <button type="button" onclick="moveLeft()">Move Left</button>
        <button type="button" onclick="headOn()">Head on</button>
        <button type="button" onclick="headOff()">Head off</button><br><br>
    
    
    <input type="checkbox" onClick="gazeWake()" id="gazeWake" checked>Gaze activated</input><br>>
    <input type="checkbox" onClick="voiceWake()" id="voiceWake" checked>Listen for Wakeword</input><br><br>


    <p>Message Bus:</p>
    <textarea id="info" name="info" rows="10" cols="50"></textarea>



</body>

</html>
<style>
    #recipe{
        width: 30%;
        background-color: beige;
        display: inline-block;
    }
    #short{
        width: 20%;
        display: inline-block;
    }
    #gaze{
        width: 49%;
        background-color: beige;
        display: inline-block;
    }
</style>