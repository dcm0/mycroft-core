<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tama Page</title>

    <script type="text/javascript">
        // window.location.hostname
        // Let us open a web socket

        var ws = new WebSocket("ws://130.237.158.153:8181/core");
        ws.onmessage = function (evt) {
            var received_msg = JSON.parse(evt.data); // the whole json
            // document.getElementById("info").value = document.getElementById("info").value + "\n" + evt.data;
            // document.getElementById("info").value = document.getElementById("info").value + "\n" + received_msg.type;
            if (received_msg.type == "enclosure.eyes.lookstatus") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoFlag = result == "true" ? true : false;
                document.getElementById("AutoHead").checked = autoFlag;
                document.getElementById("AutoHead").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
            if (received_msg.type == "enclosure.eyes.gazeWake") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoGaze = result == "true" ? true : false;
                document.getElementById("gazeWake").checked = autoGaze;
                document.getElementById("gazeWake").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
            if (received_msg.type == "enclosure.eyes.voiceWake") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoWake = result == "true" ? true : false;
                document.getElementById("voiceWake").checked = autoWake;
                document.getElementById("voiceWake").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
        };


        function ChangeColor() {
            var msg = {
                type: 'enclosure.eyes.yellow',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }




        function moveHome() {
            logData('Home');
            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': 0 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }

        // from Tama persepctives
        function moveLeft() {
            logData('Left');
            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': 30 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }


        function moveRight() {
            logData('Right');
            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': -30 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }

        function AutoHead() {
            logData('AutoHead');
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleAutolook',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }


        function headOff() {
            logData('Head off');
            var msg = {
                type: 'enclosure.eyes.off',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }

        function headOn() {
            logData('Head on');
            var msg = {
                type: 'enclosure.eyes.on',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));

        }


        function gazeWake() {
            logData('Gaze awake');
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleGazeWake',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }

        function voiceWake() {
            logData('Voice awake');
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleVoiceWake',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }


        function TextToSpeech(text) {
            logData('Speak msg' + ' ' + text);
            var msg = {
                type: 'speak',
                data: { 'utterance': text },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }

        var i = -1;
        var currentstepnum = i;
        function speackmsg(msg) {
            logData('Speak msg' + ' ' + msg);
            var msg = {
                type: 'speak',
                data: { 'utterance': msg },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }



        function next() {
            logData('Next');
            document.getElementById('inc').value = ++i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);


        }

        function back() {
            logData('Back');
            document.getElementById('inc').value = --i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }

        function restart() {
            logData('Restart');
            i = -1;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = '';
        }

        function reset() {
            logData('Reset');
            i = currentstepnum;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }

        function repeat() {
            logData('Repeat');
            i = currentstepnum;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }


        function error() {
            logData('Error');
            var msg = {
                type: 'enclosure.eyes.pink',
                data: '',
                end: '',
                context: { destination: '' }
            };

            ws.send(JSON.stringify(msg));
            msg = {
                type: 'enclosure.sounds.bing',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));


            var delayInMilliseconds = 2000;
            setTimeout(function () {
                //your code to be executed after 1 second
                console.log('go green');
                var msg = {
                    type: 'enclosure.eyes.green',
                    data: '',
                    end: '',
                    context: { destination: '' }
                };
                ws.send(JSON.stringify(msg))
            }, delayInMilliseconds);


        }


        function changeEyeColor(color) {
            var msg = {
                type: color,
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }

        function play() {
            logData('Play');
            //if we need to go to specific step number then we need to -1 as the array starts from 0
            var j = document.getElementById('inc').value;
            document.getElementById('speechtext').value = data[j - 1];
            speackmsg(data[j - 1]);
        }

        function doNoUnderstand() {
            logData('I do not understand');
            speackmsg('I am Sorry, I do not understand!');
        }

        function startTrial() {
            logData('Start trial');
        }

        function endTrial() {
            logData('End trial');
        }

        function logData(logLine) {
            var msg = {
                type: 'enclosure.trial.log',
                data: logLine,
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg));
        }


        // Adding a text and button on click
        var counter = 0;
        function addTxtBtn() {
            var textId = "createdmsg" + counter;
            //var textcounter = String(counter);
            var txt = document.createElement("INPUT");
            txt.setAttribute("type", "text");
            txt.setAttribute("value", " ");
            txt.setAttribute("id", textId);
            document.body.appendChild(txt);

            var btn = document.createElement("BUTTON")
            btn.setAttribute("value", "Speak");
            btn.innerHTML = "Speak";
            btn.setAttribute("id", String(counter));
            btn.name = "speakBtn";

            btn.onclick = function () {
                TextToSpeech(document.getElementById(textId).value);
            };

            document.body.appendChild(btn);
            counter++;

        }


        dataJson = { "1": { "n": "1", "Name": "Now, soup", "Text": "Now, we are going to cook a vegetable soup" }, "2": { "n": "2", "Name": "Olive oil", "Text": "Heat the olive oil in a large pot over medium heat" }, "2.1": { "n": "2.1", "Name": "Interject", "Text": "If you don\'t have olive oil, you can use butter" }, "2.2": { "n": "2.2", "Name": "Abrupt", "Text": "Replacing olive oil with butter, remembert to ..." }, "3": { "n": "3", "Name": "Onions", "Text": "Add the onions and season with salt and pepper" }, "4": { "n": "4", "Name": "Simmer, and add veg", "Text": "Let simmer for 3 minutes, then add the garlic, carrot, celery, and zucchini" }, "5": { "n": "5", "Name": "Season and simmer", "Text": "Season with some more salt and pepper and let simmer for 6 minutes, stirring frequently." }, "6": { "n": "6", "Name": "color", "Text": "You want the vegetables to pick up just a little color." }, "7": { "n": "7", "Name": "If thicker", "Text": "If you want a thicker soup, drain and rinse the cannellini beans and then either puree or mash half of them." }, "8": { "n": "8", "Name": "Add cannellini et al", "Text": "Add the cannellini beans, bell pepper, tomatoes, and oregano to the pot and let simmer for 3-4 minutes. " }, "9": { "n": "9", "Name": "Broth", "Text": "Pour the broth into the pot and bring to a slow boil." }, "10": { "n": "10", "Name": "swiss chard", "Text": "Once the broth is slowly bubbling, add the swiss chard." }, "11": { "n": "11", "Name": "Cook for 15", "Text": "Cover the pot and let the soup cook for 15-20 minutes." } };

        function createRecipeItem(item){
            console.log("item" + item.toString())
            htmlStringItem = "<div id=" + item.n + " style='border:1px solid black'>" + item.Name + "<button onclick=\"TextToSpeech(\"" +item.Text+ "\")\"> Speak </button> </div>";
            //htmlStringItem = "<li id=" + item.n + " >" + item.Name + "</li>";
            return htmlStringItem;
        }

        function readTextFile() {
            //filePath = '/mycroft/client/enclosure/recipe.json'
            console.log(dataJson);

            //var items = JSON.parse(dataJson);
            //console.log(items);
            var output = "<ul>";
            for (var key in dataJson) {
                item = dataJson[key]
                console.log(item);
                console.log(key);
                console.log(dataJson[key]);
                output += createRecipeItem(dataJson[key]);
                console.log(output);
                console.log("----------------");


            }

            output += "</ul>";
            document.getElementById("recipelist").innerHTML = output;

        }
        

    </script>


</head>

<body>
    <h1>Tama control station</h1>
    <div id="recipe">
   
        <div id="recipelist">
        </div>
        <br><br>

        <b>Steps Control:</b>
        <button type="button" onClick="restart()">Restart</button>
        <button type="button" onClick="back()">Back</button>
        <button onclick="next()">Next</button>
        <button type="button" onClick="repeat()">Repeat</button>
        <button type="button" onClick="reset()">Reset</button>
        <button type="button" onClick="play()">play the current step</button>
        <input type="text" id="speechtext" value=""></input>

        <label for="html">Step number:</label>
        <input type="text" id="inc" value="-1"></input><br><br>

        <button type="button" onClick="readTextFile()">Add a recipe</button>


        <b>List of recommendations:</b><br>
        <button onclick="addTxtBtn()">Add a recommendations</button>



    </div>


    <div id="short">
        <button type="button" onclick="startTrial()">Start trial</button>
        <button type="button" onclick="endTrial()">End trial</button><br><br>
        <b>Generic sayings:</b>
        <button type="button" onClick="doNoUnderstand()">I do not understand</button>
        <button type="button" onClick="error()">Error</button><br><br>
        <label for="html">Message:</label>
        <input type="text" id="textmsg" value=""></input>
        <button type="button" onClick="TextToSpeech(document.getElementById('textmsg').value)">Speak</button><br><br>
    </div>



    <div id="gaze">
        <b>Head Control:</b>
        <input type="checkbox" onClick="AutoHead()" id="AutoHead" checked>Auto head</input><br>
        < <button type="button" onclick="moveRight()">Move Right</button>
            <button type="button" onclick="moveHome()">Move Home</button>
            <button type="button" onclick="moveLeft()">Move Left</button>
            <button type="button" onclick="headOn()">Head on</button>
            <button type="button" onclick="headOff()">Head off</button><br><br>


            <input type="checkbox" onClick="gazeWake()" id="gazeWake" checked>Gaze activated</input><br>>
            <input type="checkbox" onClick="voiceWake()" id="voiceWake" checked>Listen for Wakeword</input><br><br>


            <!-- <p>Message Bus:</p> -->
            <!-- <textarea id="info" name="info" rows="10" cols="50"></textarea> -->

</body>

</html>
<style>
    #recipe {
        width: 30%;
        background-color: beige;
        display: inline-block;
    }

    #short {
        width: 20%;
        display: inline-block;
    }

    #gaze {
        width: 40%;
        background-color: beige;
        display: inline-block;
    }
</style>