<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tama Page</title>

    <script type="text/javascript">
         // window.location.hostname
        // Let us open a web socket
       
        var ws = new WebSocket("ws://193.10.9.144:8181/core");
        ws.onmessage = function (evt) {
            var received_msg = JSON.parse(evt.data); // the whole json
            document.getElementById("info").value = document.getElementById("info").value + "\n" + evt.data;
            document.getElementById("info").value = document.getElementById("info").value + "\n" + received_msg.type;
            if (received_msg.type == "enclosure.eyes.lookstatus") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoFlag = result == "true" ? true : false;
                document.getElementById("AutoHead").checked = autoFlag;
                document.getElementById("AutoHead").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
            if (received_msg.type == "enclosure.eyes.gazeWake") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoGaze = result == "true" ? true : false;
                document.getElementById("gazeWake").checked = autoGaze;
                document.getElementById("gazeWake").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
            if (received_msg.type == "enclosure.eyes.voiceWake") {
                alert(received_msg.data["data"]);
                result = received_msg.data["data"];
                autoWake = result == "true" ? true : false;
                document.getElementById("voiceWake").checked = autoWake;
                document.getElementById("voiceWake").dispatchEvent(new Event('change', { 'bubbles': true }));
            }
        };


        function SpeakTest() {
            // Web Socket is connected, send data using send()
            var msg = {
                type: 'speak',
                data: { 'utterance': 'Hi my name is Tama, what is your name.' },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))
        }



        function ChangeColor() {
            var msg = {
                type: 'enclosure.eyes.color',
                data: { 'r': 255, 'g': 0, 'b': 0 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))

        }

        function ChangeHeadPos() {

            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': -30 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))

        }


        function moveHome() {

            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': 0 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))

        }


        function moveRight() {
            var msg = {
                type: 'enclosure.head.move',
                data: { 'pos': 30 },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))

        }

        function AutoHead() {
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleAutolook',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))
        }


        function headOff() {
            var msg = {
                type: 'enclosure.eyes.off',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))

        }

        function headOn() {
            var msg = {
                type: 'enclosure.eyes.on',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))

        }


        function gazeWake() {
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleGazeWake',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))
        }

        function voiceWake() {
            ws.send("Message to send");
            var msg = {
                type: 'enclosure.eyes.toggleVoiceWake',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))
        }

        //select trial to decide what data
        var data = ['start', 'end'];
        function favTrial() {
            var mylist = document.getElementById("myList");
            document.getElementById("favourite").value = mylist.options[mylist.selectedIndex].text;
            var trial = mylist.options[mylist.selectedIndex].text;
            console.log(trial);
            if (trial == "Trial 1") {
                data = ['step 1 : we  are going to build a tower ', 'step 2 : start with block 4 yellow', 'step 3 : then add block 4 green', 'step 4 : then add block 4 red'];
                //console.log(data);
            } else if (trial == "Trial 2") {
                data = ['step 1 : we  are going to build a house ', 'step 2 : start adding 4 blue block', 'step 3 : then add 4 blue block below', 'step 4 : then add 3 block red below'];
            } else if (trial == "Trial 3") {
                data = ["step 1 place a block of type red eight",
                    "step 2 place two yellow eight ",
                    "step 3 add a blue six",
                    "step 4 place two red six",
                    "step 5 add a yellow six",
                    "step 6 place three blue four",
                    "step 7 place a blue six",
                    "step 8 add a blue four",
                    "step 9 place three green six",
                    "step 10 add a yellow six",
                    "step 11 add a red four",
                    "step 12 add a green four",
                    "step 13 place a green six",
                    "step 14 place two yellow four",
                    "step 15 add a yellow six",
                    "step 16 add two red eight",
                    "step 17 add a white eight",
                    "step 18 add two white six",
                    "step 19 place a white four",
                    "step 20 add a white two",
                    "Tower Completed",]

            }

        }


        var i = -1;
        var currentstepnum = i;
        function speackmsg(msg) {
            var msg = {
                type: 'speak',
                data: { 'utterance': msg },
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))
        }


        function next() {
            document.getElementById('inc').value = ++i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }

        function back() {
            document.getElementById('inc').value = --i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }

        function restart() {
            i = 0;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = '';
        }

        function reset() {
            i = currentstepnum;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }

        function repeat() {
            i = currentstepnum;
            document.getElementById('inc').value = i;
            currentstepnum = i;
            document.getElementById('speechtext').value = data[i];
            speackmsg(data[i]);
        }


        function error() {
            var msg = {
                type: 'enclosure.sounds.bing',
                data: '',
                end: '',
                context: { destination: '' }
            };
            ws.send(JSON.stringify(msg))
        }


        function play() {
            //if we need to go to specific step number then we need to -1 as the array starts from 0
            var j = document.getElementById('inc').value;
            document.getElementById('speechtext').value = data[j - 1];
            speackmsg(data[j - 1]);
        }

        function doNoUnderstand() {
            speackmsg('I am Sorry, I do not understand!');
        }


    </script>


</head>

<body>
    <h1>Tama control station</h1>

    <button type="button" onClick="ChangeColor()">Change eye color</button>
    <button type="button" onclick="ChangeHeadPos()">Move head</button>
    <button type="button" onClick="SpeakTest()">Speak</button> <br><br><br>

    <input type="checkbox" onClick="AutoHead()" id="AutoHead" checked>Auto head</input><br><br>
    <!--<input type="checkbox" onClick="gazeWake()" id="gazeWake" checked>Gaze activated</input><br>>
    <!--<input type="checkbox" onClick="voiceWake()" id="voiceWake" checked>Listen for Wakeword</input><br><br>-->

    <b>Head Control:</b>
    <button type="button" onclick="ChangeHeadPos()">Move Left</button>
    <button type="button" onclick="moveHome()">Move Home</button>
    <button type="button" onclick="moveRight()">Move Right</button>
    <button type="button" onclick="headOn()">Head on</button>
    <button type="button" onclick="headOff()">Head off</button><br><br>


    <b> Select your trial using dropdown list </b>
    <select id="myList" onchange="favTrial()">
        <option> ---Choose trial--- </option>
        <option> Trial 1 </option>
        <option> Trial 2 </option>
        <option> Trial 3 </option>
    </select>
    <p> Your selected trial is:
        <input type="text" id="favourite" size="20" </p><br><br>
        

    <b>Steps Control:</b>
    <button type="button" onClick="restart()">Restart</button>
    <button type="button" onClick="back()">Back</button>
    <button onclick="next()">Next</button>
    <button type="button" onClick="repeat()">Repeat</button>
    <button type="button" onClick="reset()">Reset</button>
    <button type="button" onClick="play()">play the current step</button>
    <button type="button" onClick="doNoUnderstand()">I do not understand</button>
    <button type="button" onClick="error()">Error</button><br><br>

    <label for="html">Step number:</label>
    <input type="text" id="inc" value="-1"></input><br><br>
    <label for="html">Speech Text:</label>
    <input type="text" id="speechtext" value=""></input><br><br>


    <p>Message Bus:</p>
    <textarea id="info" name="info" rows="10" cols="50"></textarea>



</body>

</html>